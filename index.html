<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury</title>
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #6c757d;
            --background-color: #f5f5f5;
            --card-background: white;
            --text-color: #333;
            --border-color: #ddd;
            --shadow-color: rgba(0,0,0,0.1);
            --hover-color: #e9ecef;
            --notification-bg: #28a745;
            --notification-text: white;
            --error-bg: #dc3545;
            --error-text: white;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #ffffff;
            --dark-border: #333;
            --dark-shadow: rgba(0,0,0,0.3);
            --dark-hover: #2d2d2d;
        }

        [data-theme="dark"] {
            --background-color: #121212;
            --card-background: #1e1e1e;
            --text-color: #ffffff;
            --border-color: #333;
            --shadow-color: rgba(0,0,0,0.3);
            --hover-color: #2d2d2d;
            --notification-bg: #28a745;
            --notification-text: white;
            --error-bg: #dc3545;
            --error-text: white;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s ease;
        }

        header {
            background-color: var(--card-background);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .header-icons {
            display: flex;
            gap: 20px;
        }

        .icon {
            cursor: pointer;
            font-size: 20px;
            color: var(--text-color);
        }

        .search-bar {
            margin: 20px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            width: 100%;
            max-width: 400px;
            background-color: var(--card-background);
            color: var(--text-color);
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 15px 20px;
            background-color: var(--card-background);
            border-bottom: 1px solid var(--border-color);
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-checkbox {
            accent-color: var(--primary-color);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .product-card {
            background: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-color);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-category {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .product-title {
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .product-price {
            font-size: 20px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .purchased-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            z-index: 5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-background);
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 5px 20px var(--shadow-color);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            color: var(--text-color);
        }

        .modal-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .modal-info {
            padding: 20px;
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .modal-category {
            font-size: 14px;
            color: var(--primary-color);
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .modal-price {
            font-size: 28px;
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 20px;
        }

        .modal-description {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .add-to-cart {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .add-to-cart:hover {
            background-color: #0056b3;
        }

        .add-to-cart.disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .cart-count {
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #ff4444;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }

        .search-suggestions {
            position: absolute;
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-top: none;
            width: 100%;
            max-width: 400px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 5px 10px var(--shadow-color);
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .suggestion-item:hover {
            background-color: var(--hover-color);
        }

        .loading-message {
            padding: 10px 15px;
            color: var(--secondary-color);
            font-style: italic;
        }

        .skeleton-card {
            background: var(--hover-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-color);
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.8;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.8;
            }
        }

        .skeleton-image {
            width: 100%;
            height: 200px;
            background: var(--border-color);
        }

        .skeleton-info {
            padding: 15px;
        }

        .skeleton-category {
            height: 12px;
            background: var(--border-color);
            margin-bottom: 5px;
            border-radius: 4px;
        }

        .skeleton-title {
            height: 16px;
            background: var(--border-color);
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .skeleton-price {
            height: 20px;
            background: var(--border-color);
            border-radius: 4px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: var(--notification-text);
            background-color: var(--notification-bg);
            z-index: 1001;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--error-bg);
        }

        /* Cart Page */
        .cart-page {
            display: none;
            padding: 20px;
        }

        .cart-header {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .cart-item {
            background: var(--card-background);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-title {
            font-size: 16px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .cart-item-price {
            font-size: 18px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .cart-remove {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .cart-remove:hover {
            background: #5a6268;
        }

        .cart-total {
            font-size: 20px;
            margin: 20px 0;
            font-weight: bold;
            color: var(--primary-color);
        }

        .checkout-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: block;
        }

        .checkout-button:hover {
            background-color: #0056b3;
        }

        .checkout-button.disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .cancel-checkout-button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
            margin: 10px auto 0;
            display: block;
        }

        .cart-empty {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }

        /* Profile Page */
        .profile-page {
            display: none;
            padding: 20px;
        }

        .profile-header {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .profile-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--card-background);
            color: var(--text-color);
        }

        .form-error {
            color: var(--error-bg);
            font-size: 14px;
            margin-top: 5px;
        }

        .profile-notifications {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .profile-save {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: block;
        }

        .profile-save:hover {
            background-color: #0056b3;
        }

        /* History Page */
        .history-page {
            display: none;
            padding: 20px;
        }

        .history-header {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .orders-item {
            background: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .order-number {
            font-weight: bold;
            color: var(--primary-color);
        }

        .order-date {
            color: var(--secondary-color);
        }

        .order-items {
            margin-bottom: 15px;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .order-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-title {
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .order-item-price {
            font-size: 16px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .order-total {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            text-align: right;
        }

        .orders-empty {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }

        /* Remove Confirmation Modal */
        .remove-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .remove-confirm-content {
            background: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 20px var(--shadow-color);
        }

        .remove-confirm-title {
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .remove-confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .remove-confirm-btn {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .remove-confirm-btn.cancel {
            background: #6c757d;
            color: white;
        }

        .remove-confirm-btn.confirm {
            background: var(--primary-color);
            color: white;
        }

        /* Theme Toggle */
        .theme-toggle {
            cursor: pointer;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .cart-item {
                flex-direction: column;
                align-items: stretch;
            }
            
            .cart-item-image {
                width: 100%;
                height: 150px;
            }
            
            .cart-remove {
                width: 100%;
                margin-top: 10px;
            }
            
            .checkout-button,
            .cancel-checkout-button,
            .profile-save {
                width: 100%;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="/" class="logo" data-test-id="menu-shop">Luxury</a>
        <div class="header-icons">
            <div class="icon" data-test-id="search-icon">üîç</div>
            <div class="icon cart-count" data-test-id="menu-cart">
                üõí
                <span class="cart-badge" data-test-id="cart-badge">0</span>
            </div>
            <div class="icon" data-test-id="menu-profile">üë§</div>
            <div class="icon" data-test-id="menu-history">‚è±Ô∏è</div>
            <div class="icon theme-toggle" data-test-id="theme-toggle">üåô</div>
        </div>
    </header>

    <!-- Product List Page -->
    <div id="product-list-page">
        <input type="text" class="search-bar" placeholder="Search products..." data-test-id="search-input">
        <div class="search-suggestions" data-test-id="search-suggestions"></div>
        
        <div class="filters">
            <div class="filter-item">
                <input type="checkbox" id="yacht-filter" class="filter-checkbox" data-test-id="filter">
                <label for="yacht-filter">Yacht</label>
            </div>
            <div class="filter-item">
                <input type="checkbox" id="plane-filter" class="filter-checkbox" data-test-id="filter">
                <label for="plane-filter">Plane</label>
            </div>
            <div class="filter-item">
                <input type="checkbox" id="mansion-filter" class="filter-checkbox" data-test-id="filter">
                <label for="mansion-filter">Mansion</label>
            </div>
            <div class="filter-item">
                <input type="checkbox" id="island-filter" class="filter-checkbox" data-test-id="filter">
                <label for="island-filter">Island</label>
            </div>
        </div>

        <div class="products-grid" data-test-id="product-list"></div>
    </div>

    <!-- Cart Page -->
    <div id="cart-page" class="cart-page">
        <h1 class="cart-header">Shopping Cart</h1>
        <div class="cart-list" data-test-id="cart-list"></div>
        <div class="cart-total" data-test-id="cart-total">Total: $0</div>
        <button class="checkout-button" data-test-id="checkout-button">Place order</button>
        <button class="checkout-button" style="display:none;" data-test-id="login-to-place-order">Login to place an order</button>
    </div>

    <!-- Profile Page -->
    <div id="profile-page" class="profile-page">
        <h1 class="profile-header">Profile</h1>
        <form class="profile-form">
            <div class="form-group">
                <label class="form-label" for="profile-name">Name</label>
                <input type="text" id="profile-name" class="form-input" data-test-id="profile-name" required>
                <div class="form-error" id="name-error"></div>
            </div>
            <div class="form-group">
                <label class="form-label" for="profile-email">E-mail</label>
                <input type="email" id="profile-email" class="form-input" data-test-id="profile-email" required>
                <div class="form-error" id="email-error"></div>
            </div>
            <div class="profile-notifications" data-test-id="profile-notifications">
                <input type="checkbox" id="notifications">
                <label for="notifications">Receive notifications about new products</label>
            </div>
            <button type="button" class="profile-save" data-test-id="profile-save">Save</button>
        </form>
    </div>

    <!-- History Page -->
    <div id="history-page" class="history-page">
        <h1 class="history-header">Order History</h1>
        <div class="orders-list" data-test-id="orders-list"></div>
        <div class="orders-empty" data-test-id="orders-empty" style="display:none;">Order history is empty</div>
    </div>

    <!-- Modals -->
    <div class="modal" id="product-modal" data-test-id="modal">
        <div class="modal-content">
            <span class="close-modal" data-test-id="modal-close">&times;</span>
            <img src="" alt="Product" class="modal-image" id="modal-image">
            <div class="modal-info">
                <h2 class="modal-title" data-test-id="modal-title" id="modal-title"></h2>
                <div class="modal-category" data-test-id="modal-type" id="modal-category"></div>
                <div class="modal-price" data-test-id="modal-price" id="modal-price"></div>
                <p class="modal-description" data-test-id="modal-description" id="modal-description"></p>
                <button class="add-to-cart" data-test-id="add-to-cart" id="add-to-cart">Add to cart</button>
            </div>
        </div>
    </div>

    <div class="remove-confirm-modal" id="remove-confirm-modal" data-test-id="remove-confirm-modal">
        <div class="remove-confirm-content">
            <div class="remove-confirm-title">Are you sure you want to remove this item?</div>
            <div class="remove-confirm-buttons">
                <button class="remove-confirm-btn cancel" id="cancel-remove">Cancel</button>
                <button class="remove-confirm-btn confirm" id="confirm-remove">Remove</button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notification" id="notification"></div>

    <script>
        // Global state
        let products = [];
        let cart = [];
        let orders = [];
        let purchasedItems = [];
        let currentProductId = null;
        let theme = 'light';
        let isCartPage = false;
        let isProfilePage = false;
        let isHistoryPage = false;
        let searchTimeout = null;
        let removeConfirmModalProductId = null;

        // DOM elements
        const productListPage = document.getElementById('product-list-page');
        const cartPage = document.getElementById('cart-page');
        const profilePage = document.getElementById('profile-page');
        const historyPage = document.getElementById('history-page');
        const productsGrid = document.querySelector('.products-grid');
        const searchInput = document.querySelector('.search-bar');
        const searchSuggestions = document.querySelector('.search-suggestions');
        const cartBadge = document.querySelector('.cart-badge');
        const cartList = document.querySelector('.cart-list');
        const cartTotal = document.querySelector('.cart-total');
        const checkoutButton = document.querySelector('.checkout-button');
        const loginToPlaceOrderButton = document.querySelector('[data-test-id="login-to-place-order"]');
        const profileNameInput = document.getElementById('profile-name');
        const profileEmailInput = document.getElementById('profile-email');
        const profileSaveButton = document.querySelector('.profile-save');
        const ordersList = document.querySelector('.orders-list');
        const ordersEmpty = document.querySelector('.orders-empty');
        const modal = document.getElementById('product-modal');
        const closeModal = document.querySelector('.close-modal');
        const modalImage = document.getElementById('modal-image');
        const modalTitle = document.getElementById('modal-title');
        const modalCategory = document.getElementById('modal-category');
        const modalPrice = document.getElementById('modal-price');
        const modalDescription = document.getElementById('modal-description');
        const addToCartBtn = document.getElementById('add-to-cart');
        const removeConfirmModal = document.getElementById('remove-confirm-modal');
        const cancelRemoveBtn = document.getElementById('cancel-remove');
        const confirmRemoveBtn = document.getElementById('confirm-remove');
        const notification = document.getElementById('notification');
        const themeToggle = document.querySelector('.theme-toggle');

        // Initialize
        function init() {
            // Load theme from localStorage
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                theme = savedTheme;
                document.documentElement.setAttribute('data-theme', theme);
                updateThemeIcon();
            }

            // Load data from localStorage or fetch from data.json
            loadProducts();

            // Check current page
            checkCurrentPage();

            // Add event listeners
            addEventListeners();
        }

        function loadProducts() {
            // Simulate loading with skeleton
            showSkeletons();
            
            // Try to load from localStorage first
            const savedProducts = localStorage.getItem('products');
            if (savedProducts) {
                try {
                    products = JSON.parse(savedProducts);
                    renderProducts();
                    return;
                } catch (e) {
                    console.log('Failed to parse saved products');
                }
            }
            
            // If no saved products, simulate fetching from data.json
            setTimeout(() => {
                // Mock data.json content
                const mockProducts = [
                    {
                        id: 1,
                        category: "Yacht",
                        title: "Azimut 77 Yacht",
                        price: 3500000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Azimut+77+Yacht",
                        description: "The Azimut 77 Yacht combines elegance with performance. Featuring luxurious interiors, spacious decks, and state-of-the-art navigation systems, this yacht offers the perfect blend of comfort and adventure for discerning sailors."
                    },
                    {
                        id: 2,
                        category: "Yacht",
                        title: "Sunseeker 86 Yacht",
                        price: 4200000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Sunseeker+86+Yacht",
                        description: "Experience luxury at sea with the Sunseeker 86 Yacht. This magnificent vessel features multiple entertainment areas, a spacious master suite, and advanced technology throughout, making it ideal for long voyages or weekend getaways."
                    },
                    {
                        id: 3,
                        category: "Yacht",
                        title: "Ferretti 960 Yacht",
                        price: 5800000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Ferretti+960+Yacht",
                        description: "The Ferretti 960 Yacht represents the pinnacle of Italian design and engineering. With its sleek lines, sophisticated interior, and exceptional performance capabilities, this yacht is designed for those who demand nothing but the best."
                    },
                    {
                        id: 4,
                        category: "Yacht",
                        title: "L√ºrssen 120 Yacht",
                        price: 7500000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=L√ºrssen+120+Yacht",
                        description: "The L√ºrssen 120 Yacht is a masterpiece of naval architecture, offering unparalleled luxury and comfort. From its expansive sun deck to its private owner's quarters, every detail has been meticulously crafted for ultimate indulgence."
                    },
                    {
                        id: 5,
                        category: "Yacht",
                        title: "Benetti 100 Yacht",
                        price: 6200000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Benetti+100+Yacht",
                        description: "The Benetti 100 Yacht showcases timeless elegance and modern sophistication. With its innovative layout, luxurious amenities, and exceptional craftsmanship, this yacht provides an unforgettable experience for owners and guests alike."
                    },
                    {
                        id: 6,
                        category: "Plane",
                        title: "Gulfstream G650ER",
                        price: 75000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Gulfstream+G650ER",
                        description: "The Gulfstream G650ER sets new standards in business aviation with its unmatched range, speed, and comfort. Featuring a spacious cabin, advanced technology, and whisper-quiet operation, it's the ultimate choice for global travelers."
                    },
                    {
                        id: 7,
                        category: "Plane",
                        title: "Bombardier Global 7500",
                        price: 73000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Bombardier+Global+7500",
                        description: "The Bombardier Global 7500 offers the longest range and most spacious cabin in its class. With four distinct living spaces, advanced connectivity, and unparalleled comfort, it redefines private air travel for executives and families."
                    },
                    {
                        id: 8,
                        category: "Plane",
                        title: "Dassault Falcon 8X",
                        price: 58000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Dassault+Falcon+8X",
                        description: "The Dassault Falcon 8X combines exceptional range with superior comfort and efficiency. Its trijet configuration ensures safety and reliability, while its luxurious interior provides a serene environment for productive work or relaxation."
                    },
                    {
                        id: 9,
                        category: "Plane",
                        title: "Cessna Citation Longitude",
                        price: 27000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Cessna+Citation+Longitude",
                        description: "The Cessna Citation Longitude offers the perfect balance of performance, comfort, and value. With its spacious cabin, advanced avionics, and impressive range, it's ideal for business travelers seeking efficiency without compromising on luxury."
                    },
                    {
                        id: 10,
                        category: "Plane",
                        title: "Embraer Phenom 300E",
                        price: 9500000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Embraer+Phenom+300E",
                        description: "The Embraer Phenom 300E is the world's fastest and most efficient light jet. Combining exceptional performance with luxurious comfort, it offers an outstanding value proposition for those seeking premium private aviation experiences."
                    },
                    {
                        id: 11,
                        category: "Mansion",
                        title: "Beverly Hills Mansion",
                        price: 125000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Beverly+Hills+Mansion",
                        description: "This iconic Beverly Hills mansion features breathtaking views, sprawling grounds, and luxurious amenities including a private cinema, spa, and infinity pool. Designed for entertaining on a grand scale, it's the epitome of California luxury living."
                    },
                    {
                        id: 12,
                        category: "Mansion",
                        title: "Malibu Beachfront Estate",
                        price: 85000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Malibu+Beachfront+Estate",
                        description: "Perched on the cliffs of Malibu, this beachfront estate offers panoramic ocean views, direct beach access, and contemporary design. The property includes a private gym, wine cellar, and outdoor entertainment areas perfect for coastal living."
                    },
                    {
                        id: 13,
                        category: "Mansion",
                        title: "New York Penthouse",
                        price: 95000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=New+York+Penthouse",
                        description: "This exclusive New York penthouse offers stunning city views, floor-to-ceiling windows, and designer finishes throughout. Features include a private rooftop terrace, chef's kitchen, and spa-quality bathrooms, providing urban luxury at its finest."
                    },
                    {
                        id: 14,
                        category: "Mansion",
                        title: "Miami Modern Oasis",
                        price: 65000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Miami+Modern+Oasis",
                        description: "This Miami modern oasis blends tropical living with contemporary design. The property features an infinity pool, lush landscaping, and seamless indoor-outdoor flow. Perfect for entertaining with its open-plan living spaces and gourmet kitchen."
                    },
                    {
                        id: 15,
                        category: "Mansion",
                        title: "Aspen Mountain Retreat",
                        price: 75000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Aspen+Mountain+Retreat",
                        description: "Nestled in the Colorado mountains, this Aspen retreat offers ski-in/ski-out access, rustic-chic interiors, and panoramic mountain views. Amenities include a heated outdoor pool, spa, and dedicated ski room, making it perfect for year-round mountain living."
                    },
                    {
                        id: 16,
                        category: "Island",
                        title: "Private Caribbean Island",
                        price: 250000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Private+Caribbean+Island",
                        description: "Own your own private paradise in the Caribbean. This island features pristine beaches, lush vegetation, and crystal-clear waters. Includes a main residence, guest villas, and facilities for water sports, making it the ultimate escape from the ordinary."
                    },
                    {
                        id: 17,
                        category: "Island",
                        title: "South Pacific Atoll",
                        price: 180000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=South+Pacific+Atoll",
                        description: "This South Pacific atoll offers untouched natural beauty with turquoise lagoons, coral reefs, and abundant marine life. The island includes sustainable eco-lodges, a research station, and opportunities for conservation efforts alongside luxury living."
                    },
                    {
                        id: 18,
                        category: "Island",
                        title: "Mediterranean Private Isle",
                        price: 150000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Mediterranean+Private+Isle",
                        description: "This Mediterranean private isle combines classic European charm with modern luxury. Featuring stone villas, olive groves, vineyards, and private coves, it offers a sophisticated lifestyle with easy access to nearby cultural destinations."
                    },
                    {
                        id: 19,
                        category: "Island",
                        title: "Indian Ocean Archipelago",
                        price: 220000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Indian+Ocean+Archipelago",
                        description: "This Indian Ocean archipelago comprises multiple islands connected by private bridges. Each island serves a different purpose - residential, recreational, agricultural - creating a self-sustaining paradise with endless possibilities for customization and expansion."
                    },
                    {
                        id: 20,
                        category: "Island",
                        title: "Tropical Pacific Haven",
                        price: 190000000,
                        image: "https://images.unsplash.com/photo-1575036619761-8e04a389d97c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                        backupImage: "https://via.placeholder.com/800x600?text=Tropical+Pacific+Haven",
                        description: "This tropical Pacific haven offers secluded beaches, dense rainforests, and volcanic landscapes. The property includes eco-friendly accommodations, a marine conservation center, and opportunities for sustainable tourism development alongside personal enjoyment."
                    }
                ];
                
                products = mockProducts;
                localStorage.setItem('products', JSON.stringify(products));
                renderProducts();
            }, 1500); // Simulate loading time
        }

        function showSkeletons() {
            productsGrid.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const skeletonCard = document.createElement('div');
                skeletonCard.className = 'skeleton-card';
                skeletonCard.dataset.testId = 'skeleton-card';
                
                skeletonCard.innerHTML = `
                    <div class="skeleton-image"></div>
                    <div class="skeleton-info">
                        <div class="skeleton-category"></div>
                        <div class="skeleton-title"></div>
                        <div class="skeleton-price"></div>
                    </div>
                `;
                
                productsGrid.appendChild(skeletonCard);
            }
        }

        function renderProducts() {
            productsGrid.innerHTML = '';
            const filteredProducts = filterProducts();
            
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.dataset.id = product.id;
                productCard.dataset.testId = 'product-card';
                
                // Check if product is purchased
                const isPurchased = purchasedItems.includes(product.id);
                
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.title}" class="product-image" onerror="this.src='${product.backupImage}'" data-test-id="product-image">
                    <div class="product-info">
                        <div class="product-category" data-test-id="product-type">${product.category}</div>
                        <div class="product-title" data-test-id="product-title">${product.title}</div>
                        <div class="product-price" data-test-id="product-price">$${product.price.toLocaleString()}</div>
                    </div>
                    ${isPurchased ? '<div class="purchased-overlay">–ö–£–ü–õ–ï–ù–û</div>' : ''}
                `;
                
                if (!isPurchased) {
                    productCard.addEventListener('click', () => showProductModal(product));
                }
                
                productsGrid.appendChild(productCard);
            });
        }

        function filterProducts() {
            const yachtChecked = document.getElementById('yacht-filter').checked;
            const planeChecked = document.getElementById('plane-filter').checked;
            const mansionChecked = document.getElementById('mansion-filter').checked;
            const islandChecked = document.getElementById('island-filter').checked;
            
            let filteredProducts = [...products];
            
            // Apply filters
            if (yachtChecked || planeChecked || mansionChecked || islandChecked) {
                filteredProducts = filteredProducts.filter(product => {
                    if (yachtChecked && product.category === 'Yacht') return true;
                    if (planeChecked && product.category === 'Plane') return true;
                    if (mansionChecked && product.category === 'Mansion') return true;
                    if (islandChecked && product.category === 'Island') return true;
                    return false;
                });
            }
            
            // Apply search
            const searchTerm = searchInput.value.trim().toLowerCase();
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.title.toLowerCase().includes(searchTerm)
                );
            }
            
            return filteredProducts;
        }

        function showProductModal(product) {
            modalImage.src = product.image;
            modalImage.onerror = () => { modalImage.src = product.backupImage; };
            modalTitle.textContent = product.title;
            modalCategory.textContent = product.category;
            modalPrice.textContent = `$${product.price.toLocaleString()}`;
            modalDescription.textContent = product.description;
            currentProductId = product.id;
            
            // Update button text based on cart status
            const isInCart = cart.some(item => item.id === product.id);
            if (isInCart) {
                addToCartBtn.textContent = 'Remove from cart';
                addToCartBtn.dataset.testId = 'remove-from-cart';
            } else {
                addToCartBtn.textContent = 'Add to cart';
                addToCartBtn.dataset.testId = 'add-to-cart';
            }
            
            modal.style.display = 'flex';
        }

        function closeProductModal() {
            modal.style.display = 'none';
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const isInCart = cart.some(item => item.id === productId);
            
            if (isInCart) {
                // Remove from cart
                cart = cart.filter(item => item.id !== productId);
                addToCartBtn.textContent = 'Added';
                addToCartBtn.classList.add('disabled');
                addToCartBtn.dataset.testId = 'add-to-cart';
                
                setTimeout(() => {
                    addToCartBtn.textContent = 'Add to cart';
                    addToCartBtn.classList.remove('disabled');
                    showNotification('Looking for something better?');
                }, 2000);
            } else {
                // Add to cart
                cart.push({
                    id: productId,
                    title: product.title,
                    price: product.price,
                    image: product.image,
                    category: product.category
                });
                addToCartBtn.textContent = 'Added';
                addToCartBtn.classList.add('disabled');
                addToCartBtn.dataset.testId = 'remove-from-cart';
                
                setTimeout(() => {
                    addToCartBtn.textContent = 'Remove from cart';
                    addToCartBtn.classList.remove('disabled');
                    showNotification('Great choice!');
                }, 2000);
            }
            
            // Save cart to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            updateCartPage();
        }

        function updateCartCount() {
            cartBadge.textContent = cart.length;
            if (cart.length === 0) {
                cartBadge.style.display = 'none';
            } else {
                cartBadge.style.display = 'flex';
            }
        }

        function updateCartPage() {
            if (!isCartPage) return;
            
            cartList.innerHTML = '';
            
            if (cart.length === 0) {
                cartList.innerHTML = '<div class="cart-empty" data-test-id="cart-empty">Cart is empty</div>';
                cartTotal.textContent = 'Total: $0';
                checkoutButton.style.display = 'none';
                loginToPlaceOrderButton.style.display = 'none';
                return;
            }
            
            let total = 0;
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.dataset.testId = 'cart-item';
                cartItem.dataset.id = item.id;
                
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" class="cart-item-image">
                    <div class="cart-item-info">
                        <div class="cart-item-title" data-test-id="cart-item-title">${item.title}</div>
                        <div class="cart-item-price" data-test-id="cart-item-price">$${item.price.toLocaleString()}</div>
                    </div>
                    <button class="cart-remove" data-test-id="cart-remove">Remove</button>
                `;
                
                cartList.appendChild(cartItem);
                total += item.price;
                
                // Add event listener for remove button
                cartItem.querySelector('.cart-remove').addEventListener('click', () => {
                    removeConfirmModalProductId = item.id;
                    removeConfirmModal.style.display = 'flex';
                });
            });
            
            cartTotal.textContent = `Total: $${total.toLocaleString()}`;
            
            // Check if user is authorized
            const userProfile = getUserProfile();
            if (userProfile && userProfile.name && userProfile.email) {
                checkoutButton.style.display = 'block';
                loginToPlaceOrderButton.style.display = 'none';
            } else {
                checkoutButton.style.display = 'none';
                loginToPlaceOrderButton.style.display = 'block';
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            updateCartPage();
            showNotification('Looking for something better?');
        }

        function placeOrder() {
            if (cart.length === 0) return;
            
            const userProfile = getUserProfile();
            if (!userProfile || !userProfile.name || !userProfile.email) {
                // Redirect to profile page
                window.location.href = '/profile.html';
                return;
            }
            
            // Create order
            const timestamp = Date.now();
            const order = {
                id: `ORD-${timestamp}`,
                date: new Date(timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }),
                items: [...cart],
                total: cart.reduce((sum, item) => sum + item.price, 0)
            };
            
            // Add to orders
            orders.unshift(order);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Clear cart
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Show cancel button for 1.5 seconds
            checkoutButton.style.display = 'none';
            const cancelCheckoutButton = document.createElement('button');
            cancelCheckoutButton.className = 'cancel-checkout-button';
            cancelCheckoutButton.textContent = 'Cancel';
            cancelCheckoutButton.dataset.testId = 'cancel-checkout-button';
            cartPage.appendChild(cancelCheckoutButton);
            
            setTimeout(() => {
                cancelCheckoutButton.remove();
                checkoutButton.style.display = 'block';
                // Redirect to history page
                window.location.href = '/history.html';
            }, 1500);
        }

        function updateHistoryPage() {
            if (!isHistoryPage) return;
            
            ordersList.innerHTML = '';
            
            if (orders.length === 0) {
                ordersEmpty.style.display = 'block';
                return;
            }
            
            ordersEmpty.style.display = 'none';
            
            orders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = 'orders-item';
                orderItem.dataset.testId = 'orders-item';
                
                orderItem.innerHTML = `
                    <div class="order-header">
                        <div class="order-number" data-test-id="order-number">${order.id}</div>
                        <div class="order-date" data-test-id="order-date">${order.date}</div>
                    </div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div class="order-item">
                                <img src="${item.image}" alt="${item.title}" class="order-item-image">
                                <div class="order-item-info">
                                    <div class="order-item-title" data-test-id="order-item-title">${item.title}</div>
                                    <div class="order-item-price" data-testId="order-item-price">$${item.price.toLocaleString()}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="order-total" data-test-id="order-total">Total: $${order.total.toLocaleString()}</div>
                `;
                
                ordersList.appendChild(orderItem);
            });
        }

        function updateProfilePage() {
            if (!isProfilePage) return;
            
            // Load user profile from localStorage
            const userProfile = getUserProfile();
            if (userProfile) {
                profileNameInput.value = userProfile.name || '';
                profileEmailInput.value = userProfile.email || '';
                document.getElementById('notifications').checked = userProfile.notifications || false;
            }
        }

        function saveUserProfile() {
            const name = profileNameInput.value.trim();
            const email = profileEmailInput.value.trim();
            const notifications = document.getElementById('notifications').checked;
            
            // Validate inputs
            let isValid = true;
            
            if (!name) {
                showError('name-error', 'Name is required');
                isValid = false;
            } else {
                clearError('name-error');
            }
            
            if (!email) {
                showError('email-error', 'Email is required');
                isValid = false;
            } else if (!isValidEmail(email)) {
                showError('email-error', 'Invalid email format');
                isValid = false;
            } else {
                clearError('email-error');
            }
            
            if (!isValid) return;
            
            // Save profile
            const userProfile = {
                name: name,
                email: email,
                notifications: notifications
            };
            
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            showNotification('Data saved');
        }

        function isValidEmail(email) {
            // Simple email validation: must have one @ and at most one dot after @
            const atIndex = email.indexOf('@');
            if (atIndex === -1 || atIndex === 0 || atIndex === email.length - 1) {
                return false;
            }
            
            const afterAt = email.substring(atIndex + 1);
            const dotCount = afterAt.split('.').length - 1;
            if (dotCount > 1) {
                return false;
            }
            
            return true;
        }

        function getUserProfile() {
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                try {
                    return JSON.parse(savedProfile);
                } catch (e) {
                    return null;
                }
            }
            return null;
        }

        function showNotification(message, isError = false) {
            notification.textContent = message;
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function clearError(elementId) {
            const element = document.getElementById(elementId);
            element.textContent = '';
            element.style.display = 'none';
        }

        function toggleTheme() {
            theme = theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        function checkCurrentPage() {
            const path = window.location.pathname;
            
            if (path.endsWith('/cart.html')) {
                isCartPage = true;
                isProfilePage = false;
                isHistoryPage = false;
                productListPage.style.display = 'none';
                cartPage.style.display = 'block';
                profilePage.style.display = 'none';
                historyPage.style.display = 'none';
                updateCartPage();
            } else if (path.endsWith('/profile.html')) {
                isCartPage = false;
                isProfilePage = true;
                isHistoryPage = false;
                productListPage.style.display = 'none';
                cartPage.style.display = 'none';
                profilePage.style.display = 'block';
                historyPage.style.display = 'none';
                updateProfilePage();
            } else if (path.endsWith('/history.html')) {
                isCartPage = false;
                isProfilePage = false;
                isHistoryPage = true;
                productListPage.style.display = 'none';
                cartPage.style.display = 'none';
                profilePage.style.display = 'none';
                historyPage.style.display = 'block';
                updateHistoryPage();
            } else {
                isCartPage = false;
                isProfilePage = false;
                isHistoryPage = false;
                productListPage.style.display = 'block';
                cartPage.style.display = 'none';
                profilePage.style.display = 'none';
                historyPage.style.display = 'none';
                renderProducts();
            }
        }

        function addEventListeners() {
            // Filter checkboxes
            document.querySelectorAll('.filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', renderProducts);
            });
            
            // Search input
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    renderProducts();
                    
                    // Show suggestions
                    const searchTerm = searchInput.value.trim().toLowerCase();
                    if (searchTerm) {
                        searchSuggestions.style.display = 'block';
                        searchSuggestions.innerHTML = '<div class="loading-message">Loading...</div>';
                        
                        setTimeout(() => {
                            const suggestions = products
                                .filter(product => product.title.toLowerCase().includes(searchTerm))
                                .sort((a, b) => a.title.localeCompare(b.title))
                                .slice(0, 3);
                            
                            searchSuggestions.innerHTML = '';
                            
                            if (suggestions.length === 0) {
                                searchSuggestions.innerHTML = '<div class="suggestion-item">No results found</div>';
                            } else {
                                suggestions.forEach(suggestion => {
                                    const suggestionItem = document.createElement('div');
                                    suggestionItem.className = 'suggestion-item';
                                    suggestionItem.dataset.testId = 'suggestion-item';
                                    suggestionItem.textContent = suggestion.title;
                                    suggestionItem.addEventListener('click', () => {
                                        // Reset filters
                                        document.getElementById('yacht-filter').checked = false;
                                        document.getElementById('plane-filter').checked = false;
                                        document.getElementById('mansion-filter').checked = false;
                                        document.getElementById('island-filter').checked = false;
                                        
                                        // Set search term
                                        searchInput.value = suggestion.title;
                                        
                                        // Filter products
                                        renderProducts();
                                        
                                        // Open modal if not purchased
                                        if (!purchasedItems.includes(suggestion.id)) {
                                            showProductModal(suggestion);
                                        }
                                        
                                        searchSuggestions.style.display = 'none';
                                    });
                                    searchSuggestions.appendChild(suggestionItem);
                                });
                            }
                        }, 1500);
                    } else {
                        searchSuggestions.style.display = 'none';
                    }
                }, 300);
            });
            
            // Search input blur
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    searchSuggestions.style.display = 'none';
                }, 200);
            });
            
            // Search input keydown
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    renderProducts();
                }
            });
            
            // Close modal
            closeModal.addEventListener('click', closeProductModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeProductModal();
                }
            });
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeProductModal();
                }
            });
            
            // Add to cart button
            addToCartBtn.addEventListener('click', () => {
                addToCart(currentProductId);
            });
            
            // Cart icon click
            document.querySelector('.cart-count').addEventListener('click', () => {
                window.location.href = '/cart.html';
            });
            
            // Profile icon click
            document.querySelector('[data-test-id="menu-profile"]').addEventListener('click', () => {
                window.location.href = '/profile.html';
            });
            
            // History icon click
            document.querySelector('[data-test-id="menu-history"]').addEventListener('click', () => {
                window.location.href = '/history.html';
            });
            
            // Checkout button
            checkoutButton.addEventListener('click', placeOrder);
            
            // Login to place order button
            loginToPlaceOrderButton.addEventListener('click', () => {
                window.location.href = '/profile.html';
            });
            
            // Remove confirmation modal
            cancelRemoveBtn.addEventListener('click', () => {
                removeConfirmModal.style.display = 'none';
            });
            
            confirmRemoveBtn.addEventListener('click', () => {
                removeFromCart(removeConfirmModalProductId);
                removeConfirmModal.style.display = 'none';
            });
            
            // Profile save button
            profileSaveButton.addEventListener('click', saveUserProfile);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // URL change detection
            window.addEventListener('popstate', checkCurrentPage);
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
